(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{15:function(e,t,s){s("9pn0"),s("mWe9"),e.exports=s("Lv+L")},"9pn0":function(e,t){!function(){"use strict";PF.TreeItemPicker=Class({_par:null,_openItem:null,_selectedItems:[],_loadedItems:[],_breadcrumbs:[],_searchMode:!1,_searchInput:null,_searchTimeout:null,_wrapId:"",_itemListNode:null,__construct:function(e){this._par=e,this._render()},_render:function(){this._searchInput=tag("input",{name:"search-input",type:"text",className:"search",prop:{onkeyup:this._onkeyup,onfocus:this._onfocus,placeholder:this._par.placeholder}}),this._actualInput=tag("select",{name:this._par.inputName,className:"hide",prop:{multiple:"multiple"}}),this._searchWrapperNode=tag("div","product-category-picker__search-wrapper",[tag("div","product-category-picker__search-wrapper__search",[tag("div","search-wrapper",[this._searchInput,this._actualInput])])]),this._wrapId="tree-item-picker-wrap-"+Math.floor(99999*Math.random()),this._pickerNode=tag("div",{className:"product-category-picker",id:this._wrapId},[tag("label","",[this._par.label]),this._searchWrapperNode]),this.node=this._pickerNode,this._addCloseEventListener(),this._loadRootItems(),this._par.selectedIds.length&&this._preSelectItems(this._par.selectedIds)},_preSelectItems:function(e){this._par.repository.getByIds(e,function(e){this._selectedItems=e,this._updateSelectedItems()}.bind(this))},validate:function(){return!(this._par.required&&!this.getValue().length)||(this.addError(dlang("dashboard","This field is required!")),!1)},getValue:function(){var e=[];for(var t in this._selectedItems){var s=this._selectedItems[t];e.push(s.id)}return e},addError:function(e){this.removeError(),mkE.addClassName(this._pickerNode,"has-error"),this._errorNode=tag("div","help-block",[e]),this._errorNode.append(this._pickerNode)},removeError:function(){mkE.removeClassName(this._pickerNode,"has-error"),this._errorNode&&(this._errorNode.remove(),this._errorNode=null)},_renderTags:function(){if(this._tagsNode?mkE.clearNode(this._tagsNode):(this._tagsNode=tag("div","product-category-picker__search-wrapper__tags"),this._tagsNode.append(this._searchWrapperNode)),this._selectedItems.length)for(var e in this._selectedItems){var t=this._selectedItems[e];tag("div","product-category-picker__search-wrapper__tag",[t.name,tag("img",{src:"/static/images/custom-products/close-small.svg",onclick:this._onRemoveSelectedItem.bind(this,t)})]).append(this._tagsNode)}else mkE.removeNode(this._tagsNode),this._tagsNode=null},_renderSuggestions:function(){this._itemListNode?mkE.clearNode(this._itemListNode):(this._itemListNode=tag("div","product-category-picker__category-list"),this._itemListNode.append(this.node)),this._showItemListNode(),this._addLoader(),this._searchMode||this._renderBreadcrumbs(),this._loadItems(this._itemsLoaded)},_hideItemListNode:function(){this._itemListNode&&mkE.addClassName(this._itemListNode,"hide")},_showItemListNode:function(){this._itemListNode&&mkE.removeClassName(this._itemListNode,"hide")},_selectItem:function(e){this._par.allowMultipleItems?-1===this._selectedItems.indexOf(e)&&this._selectedItems.push(e):this._selectedItems=[e],this.removeError(),this._updateSelectedItems(),this._hideItemListNode()},_updateActualInputValue:function(){for(var e in mkE.clearNode(this._actualInput),this._selectedItems){var t=this._selectedItems[e];tag("option",{value:t.id,attr:{selected:"selected"}},t.name).append(this._actualInput)}},_onOpenItemClick:function(e,t){this._turnSearchModeOff(),this._processOpenItem(e),t.stopPropagation()},_processOpenItem:function(e){this._openItem=e,this._breadcrumbs.push(e),this._renderSuggestions()},_onkeyup:function(){this._searchTimeout&&clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(function(){this._breadcrumbs=[],this._searchMode=!!this._searchInput.value.length,this._renderSuggestions()}.bind(this),this._par.searchTimeout)},_onfocus:function(){this._renderSuggestions()},_searchItems:function(e,t){this._par.repository.searchItems(e,(function(e){"function"==typeof t&&t(e)}))},_getItems:function(e,t){this._loadedItems[e]?"function"==typeof t&&t(this._loadedItems[e]):this._par.repository.getChildItems(e,function(s){this._loadedItems[e]=s,"function"==typeof t&&t(this._loadedItems[e])}.bind(this))},_loadRootItems:function(){this._par.repository.getRootItems(function(e){this._loadedItems[0]=e}.bind(this))},_itemsLoaded:function(e){var t=tag("ul");(this._removeLoader(),e.length)||tag("li","error",[this._par.noItemText]).append(t);for(var s in e){var i=e[s],r=[tag("a",{onclick:this._onItemClick.bind(this,i)},i.name)];this._par.onlyLeafCategories||i.isLeaf||r.push(tag("a",{className:"pull-right",onclick:this._onOpenItemClick.bind(this,i)},["+"])),tag("li","",r).append(t)}t.append(this._itemListNode)},_loadItems:function(e){if(this._searchMode)this._searchInput.value.length>=this._par.minLength&&this._searchItems(this._searchInput.value,function(t){e(t)}.bind(this));else{var t=this._openItem?this._openItem.id:0;this._getItems(t,function(t){e(t)}.bind(this))}},_onRemoveSelectedItem:function(e,t){var s=this._selectedItems.indexOf(e);s<0||(this._selectedItems.splice(s,1),this._updateSelectedItems(),t.stopPropagation())},_updateSelectedItems:function(){this._updateActualInputValue(),this._renderTags()},_onItemClick:function(e,t){this._searchMode&&this._turnSearchModeOff(),this._par.onlyLeafItems&&!e.isLeaf?this._processOpenItem(e):this._selectItem(e),t.stopPropagation()},_turnSearchModeOff:function(){this._searchMode=!1,this._searchInput.value=""},_renderBreadcrumbs:function(){if(this._breadcrumbsNode||(this._breadcrumbsNode=tag("div","product-category-picker__breadcrumbs")),this._breadcrumbsNode.append(this._itemListNode),mkE.clearNode(this._breadcrumbsNode),this._breadcrumbs.length){var e=tag("div","product-category-picker__breadcrumbs__menu-icon",[tag("a",{onclick:this._onBreadcrumbsMenuClick},[tag("img",{src:"/static/images/custom-products/menu.svg"})])]);for(var t in e.append(this._breadcrumbsNode),this._breadcrumbs){var s=this._breadcrumbs[t],i=[tag("a",{onclick:this._onBreadcrumbClick.bind(this,s)},s.name)];parseInt(t)+1!==this._breadcrumbs.length&&i.push(tag("div","product-category-picker__breadcrumbs__divider-icon",[tag("img",{src:"/static/images/custom-products/divider-arrow.svg"})])),tag("div","product-category-picker__breadcrumbs__item",i).append(this._breadcrumbsNode)}}else mkE.remove(this._breadcrumbsNode)},_onBreadcrumbsMenuClick:function(e){this._breadcrumbs=[],this._openItem=null,this._renderSuggestions(),e.stopPropagation()},_onBreadcrumbClick:function(e,t){var s=this._breadcrumbs.indexOf(e);s<0||(this._breadcrumbs.splice(s+1),this._openItem=e,this._renderSuggestions(),t.stopPropagation())},_addLoader:function(){},_removeLoader:function(){},_addCloseEventListener:function(){window.addEventListener("click",this._processClick,!0)},_processClick:function(e){if(PF.Utils.isInDocument(this.node)){var t=document.getElementById(this._wrapId),s=e.target,i=!1;do{if(s===t){i=!0;break}s=s.parentNode}while(s);i||this._hideItemListNode()}else window.removeEventListener("click",this._processClick,!0)}},mkE.Base)}()},"Lv+L":function(e,t){!function(){"use strict";PF.TreeItemPicker.Par=Class({inputName:"items",placeholder:dlang("dashboard","Search item..."),label:dlang("dashboard","Item"),noItemText:dlang("dashboard","Sorry, there are no items to show"),repository:null,allowMultipleItems:!1,onlyLeafItems:!1,required:!0,minLength:3,searchTimeout:500,selectedIds:[]})}()},mWe9:function(e,t){!function(){"use strict";PF.TreeItemPicker.Item=Class({id:null,name:null,parentId:null,isLeaf:!1})}()}},[[15,0]]]);