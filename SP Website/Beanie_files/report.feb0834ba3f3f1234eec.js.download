(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{33:function(t,e,o){t.exports=o("dV0D")},dV0D:function(t,e){!function(){"use strict";PF.ReportUploader=Class({uploadButtonHolderId:"messenger-upload-button",uploadFileHolder:"messenger-upload-file",submitButtonId:"modal-submit-btn",uploadType:"report-attachment",filesUploading:0,shipmentId:0,submitButton:function(){return $("#"+this.submitButtonId)},__construct:function(t){this.shipmentId=t,new PF.Components.BasicUploadButton({extensions:[],caption:dlang("reports","Select images"),uploadType:this.uploadType,allowMultiple:!0,onUploaded:this._onUploaded,onProcessed:this._onProcessed,onProcessingFailed:this._onFailed,onStarted:this._onStarted}).append(document.getElementById(this.uploadButtonHolderId));var e=this;this.submitButton().on("click",(function(t){return t.preventDefault(),e._checkButton()||e._submitForm(),e._disableButton(),!0}))},_submitForm:function(){var t=$(".bs-modal #report-form").serialize(),e=this;$("#report-error-block").html(""),$.post("/dashboard/shipment-report/save-report",t,(function(t){t.error?$("#report-error-block").html("<div class='alert alert-danger'>"+t.error+"</div>"):($("#report-form-holder").html(t.success),$("#problem-report-"+e.shipmentId).remove()),e._enableButton()}))},_onStarted:function(){this._disableButton()},_onUploaded:function(t){this.filesUploading+=1;var e=mkE({tag:"div",id:"block-"+t.temporaryFileKey,className:"report-image-container",els:[{tag:"img",className:"report-image-holder no-image",src:"/static/images/upload/processing.gif"}]});$("#"+this.uploadFileHolder)[0].append(e)},_onProcessed:function(t){RPC("shipment-report/temp-file-url",{fileKey:t.temporaryFileKey},(function(e){var o=mkE({tag:"div",className:"report-image-container",els:[{tag:"div",className:"report-image-button-holder",els:[{tag:"a",className:"btn btn-default",text:lang("Remove file"),href:"javascript:",onclick:function(){o.remove()}}]},{tag:"img",className:"report-image-holder",src:e.fileUrl},{tag:"span",className:"report-image-remove",text:t.filename},{tag:"input",type:"hidden",name:"Uploader[files][]",className:"uploadFile",value:t.temporaryFileKey}]}),i=document.getElementById("block-"+t.temporaryFileKey);o.replace(i)})),this.filesUploading-=1,this._enableButton()},_enableButton:function(){0===this.filesUploading&&(this.submitButton().text(dlang("reports","Report Problem")),this.submitButton().removeAttr("disabled"))},_disableButton:function(){this.submitButton().text(lang("Please wait...")),this.submitButton().attr("disabled","disabled")},_checkButton:function(){this.submitButton().attr("disable")},_onFailed:function(){$("#report-error-block").html("<div class='alert alert-danger'>"+dlang("stores","Something went wrong! Please get in touch with our customer support.")+"</div>")}},mkE.Base)}()}},[[33,0]]]);